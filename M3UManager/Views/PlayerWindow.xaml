<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="M3UManager.Views.PlayerWindow"
             Title="Media Player"
             BackgroundColor="#0A0A0A">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Media Element -->
        <toolkit:MediaElement x:Name="mediaElement"
                              Grid.Row="0"
                              ShouldShowPlaybackControls="False"
                              ShouldAutoPlay="True"
                              ShouldKeepScreenOn="True"
                              BackgroundColor="Black"
                              HeightRequest="600"
                              WidthRequest="800" />

        <!-- Custom Playback Controls Overlay -->
        <Grid Grid.Row="0"
              x:Name="controlsOverlay"
              IsVisible="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <!-- Gradient Overlays for better readability -->
            <BoxView Grid.Row="0"
                     HeightRequest="120"
                     VerticalOptions="Start">
                <BoxView.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#AA000000" Offset="0.0" />
                        <GradientStop Color="#00000000" Offset="1.0" />
                    </LinearGradientBrush>
                </BoxView.Background>
            </BoxView>
            
            <BoxView Grid.Row="2"
                     HeightRequest="180"
                     VerticalOptions="End">
                <BoxView.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#00000000" Offset="0.0" />
                        <GradientStop Color="#DD000000" Offset="1.0" />
                    </LinearGradientBrush>
                </BoxView.Background>
            </BoxView>

            <!-- Top Bar: Channel Name -->
            <StackLayout Grid.Row="0"
                        Padding="25,20"
                        VerticalOptions="Start">
                <Label x:Name="overlayChannelName"
                       Text="Channel Name"
                       TextColor="White"
                       FontSize="24"
                       FontAttributes="Bold"
                       Shadow="{Shadow Brush=Black, Offset='2,2', Radius=8, Opacity=0.8}" />
            </StackLayout>

            <!-- Center: Play/Pause Button -->
            <Border Grid.Row="1"
                    BackgroundColor="#40000000"
                    StrokeThickness="3"
                    Stroke="White"
                    StrokeShape="RoundRectangle 50"
                    WidthRequest="90"
                    HeightRequest="90"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Shadow="{Shadow Brush=Black, Offset='0,4', Radius=15, Opacity=0.6}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnPlayPauseClicked" />
                </Border.GestureRecognizers>
                <Button x:Name="playPauseButton"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="45"
                        Text="â¸"
                        Clicked="OnPlayPauseClicked"
                        BorderWidth="0" />
            </Border>

            <!-- Bottom Controls -->
            <StackLayout Grid.Row="2"
                        Padding="25,0,25,25"
                        Spacing="15"
                        VerticalOptions="End">
                
                <!-- Progress Bar and Time -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Current Time -->
                    <Label Grid.Column="0"
                           x:Name="currentTimeLabel"
                           Text="00:00"
                           TextColor="White"
                           FontSize="15"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           Margin="0,0,12,0"
                           Shadow="{Shadow Brush=Black, Offset='1,1', Radius=4, Opacity=0.8}" />

                    <!-- Progress Slider -->
                    <Slider Grid.Column="1"
                            x:Name="progressSlider"
                            Minimum="0"
                            Maximum="100"
                            Value="0"
                            ThumbColor="#FFFFFF"
                            MinimumTrackColor="#E50914"
                            MaximumTrackColor="#4A4A4A"
                            DragStarted="OnProgressDragStarted"
                            ValueChanged="OnProgressChanged"
                            DragCompleted="OnProgressDragCompleted"
                            HeightRequest="40" />

                    <!-- Total Duration -->
                    <Label Grid.Column="2"
                           x:Name="durationLabel"
                           Text="00:00"
                           TextColor="White"
                           FontSize="15"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           Margin="12,0,0,0"
                           Shadow="{Shadow Brush=Black, Offset='1,1', Radius=4, Opacity=0.8}" />
                </Grid>

                <!-- Control Buttons -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Rewind 10s -->
                    <Border Grid.Column="0"
                            BackgroundColor="#30FFFFFF"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,8"
                            Margin="0,0,8,0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnRewind10Clicked" />
                        </Border.GestureRecognizers>
                        <Label Text="âª 10s"
                               TextColor="White"
                               FontSize="13"
                               FontAttributes="Bold"
                               VerticalOptions="Center" />
                    </Border>

                    <!-- Forward 10s -->
                    <Border Grid.Column="1"
                            BackgroundColor="#30FFFFFF"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,8"
                            Margin="0,0,15,0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnForward10Clicked" />
                        </Border.GestureRecognizers>
                        <Label Text="10s â©"
                               TextColor="White"
                               FontSize="13"
                               FontAttributes="Bold"
                               VerticalOptions="Center" />
                    </Border>

                    <!-- Volume Control -->
                    <Grid Grid.Column="2" WidthRequest="160" Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                x:Name="volumeButton"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="20"
                                Text="ðŸ”Š"
                                Clicked="OnVolumeToggleClicked"
                                WidthRequest="45"
                                HeightRequest="45"
                                Padding="0"
                                BorderWidth="0" />

                        <Slider Grid.Column="1"
                                x:Name="volumeSlider"
                                Minimum="0"
                                Maximum="100"
                                Value="100"
                                ThumbColor="White"
                                MinimumTrackColor="#FFFFFF"
                                MaximumTrackColor="#4A4A4A"
                                ValueChanged="OnVolumeChanged"
                                Margin="5,0,0,0"
                                VerticalOptions="Center" />
                    </Grid>

                    <!-- Spacer -->
                    <BoxView Grid.Column="3" Color="Transparent" />

                    <!-- Fullscreen Button -->
                    <Border Grid.Column="4"
                            BackgroundColor="#30FFFFFF"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="10"
                            Margin="0,0,8,0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFullscreenClicked" />
                        </Border.GestureRecognizers>
                        <Label x:Name="fullscreenButton"
                               Text="â›¶"
                               TextColor="White"
                               FontSize="18"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />
                    </Border>

                    <!-- Settings/Quality Button -->
                    <Border Grid.Column="5"
                            BackgroundColor="#30FFFFFF"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="10"
                            Margin="0,0,8,0">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnSettingsClicked" />
                        </Border.GestureRecognizers>
                        <Label x:Name="settingsButton"
                               Text="âš™"
                               TextColor="White"
                               FontSize="18"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />
                    </Border>
                    
                    <!-- PIP Mode Button -->
                    <Border Grid.Column="6"
                            BackgroundColor="#E50914"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,8">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnPipModeClicked" />
                        </Border.GestureRecognizers>
                        <Label Text="PiP"
                               TextColor="White"
                               FontSize="13"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />
                    </Border>
                </Grid>
            </StackLayout>

            <!-- Tap to show/hide controls -->
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnPlayerTapped" />
            </Grid.GestureRecognizers>
        </Grid>

        <!-- Bottom Info Panel -->
        <Border Grid.Row="1"
                BackgroundColor="#141414"
                Padding="20,15"
                StrokeThickness="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackLayout Grid.Column="0" 
                            Spacing="6"
                            VerticalOptions="Center">
                    <Label x:Name="channelNameLabel"
                           Text="Channel Name"
                           TextColor="White"
                           FontSize="18"
                           FontAttributes="Bold" />
                    <Label x:Name="streamUrlLabel"
                           Text="Stream URL"
                           TextColor="#B3B3B3"
                           FontSize="12"
                           LineBreakMode="TailTruncation" />
                </StackLayout>

                <Border Grid.Column="1"
                        BackgroundColor="#E50914"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 8"
                        Padding="20,10"
                        VerticalOptions="Center">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCloseClicked" />
                    </Border.GestureRecognizers>
                    <Label Text="âœ• Close"
                           TextColor="White"
                           FontSize="14"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center" />
                </Border>
            </Grid>
        </Border>
    </Grid>
</ContentPage>
