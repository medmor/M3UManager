<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="M3UManager.Views.PipWindow"
             Title="Now Playing"
             BackgroundColor="Transparent">
    
    <Border x:Name="pipContainer"
            BackgroundColor="Black"
            StrokeThickness="2"
            Stroke="#007ACC"
            StrokeShape="RoundRectangle 8"
            Margin="0">
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Media Player -->
            <toolkit:MediaElement x:Name="mediaElement"
                                  Grid.Row="0"
                                  ShouldShowPlaybackControls="False"
                                  ShouldAutoPlay="True"
                                  ShouldKeepScreenOn="True"
                                  BackgroundColor="Black" />

            <!-- Custom Controls Overlay -->
            <Grid Grid.Row="0" 
                  x:Name="controlsOverlay"
                  BackgroundColor="#80000000"
                  IsVisible="True"
                  Padding="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Top Bar with Channel Name -->
                <Label Grid.Row="0"
                       x:Name="channelNameLabel"
                       Text="Channel Name"
                       TextColor="White"
                       FontSize="14"
                       FontAttributes="Bold"
                       Margin="0,0,0,5" />

                <!-- Center Play/Pause Button -->
                <Button Grid.Row="1"
                        x:Name="playPauseButton"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="40"
                        Text="â¸"
                        Clicked="OnPlayPauseClicked"
                        WidthRequest="50"
                        HeightRequest="50"
                        HorizontalOptions="Center"
                        VerticalOptions="Center" />

                <!-- Bottom Controls -->
                <Grid Grid.Row="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Progress Bar -->
                    <Grid Grid.Row="0" Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Label Grid.Column="0"
                               x:Name="currentTimeLabel"
                               Text="00:00"
                               TextColor="White"
                               FontSize="10"
                               VerticalOptions="Center"
                               Margin="0,0,5,0" />

                        <Slider Grid.Column="1"
                                x:Name="progressSlider"
                                Minimum="0"
                                Maximum="100"
                                Value="0"
                                ThumbColor="White"
                                MinimumTrackColor="#E50914"
                                MaximumTrackColor="#4A4A4A"
                                DragStarted="OnProgressDragStarted"
                                ValueChanged="OnProgressChanged"
                                DragCompleted="OnProgressDragCompleted" />

                        <Label Grid.Column="2"
                               x:Name="durationLabel"
                               Text="00:00"
                               TextColor="White"
                               FontSize="10"
                               VerticalOptions="Center"
                               Margin="5,0,0,0" />
                    </Grid>

                    <!-- Control Buttons -->
                    <HorizontalStackLayout Grid.Row="1"
                                          HorizontalOptions="Center"
                                          Spacing="8">
                        
                        <Button Text="âª"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="14"
                                Clicked="OnRewind10Clicked"
                                WidthRequest="30"
                                HeightRequest="30"
                                Padding="0" />

                        <Button Text="â©"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="14"
                                Clicked="OnForward10Clicked"
                                WidthRequest="30"
                                HeightRequest="30"
                                Padding="0" />

                        <Button x:Name="volumeButton"
                                Text="ðŸ”Š"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="14"
                                Clicked="OnVolumeClicked"
                                WidthRequest="30"
                                HeightRequest="30"
                                Padding="0" />

                        <Button Text="â›¶"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontSize="14"
                                Clicked="OnExpandClicked"
                                WidthRequest="30"
                                HeightRequest="30"
                                Padding="0" />

                        <Button Text="âœ•"
                                BackgroundColor="#DC3545"
                                TextColor="White"
                                FontSize="14"
                                Clicked="OnCloseClicked"
                                WidthRequest="30"
                                HeightRequest="30"
                                Padding="0" />
                    </HorizontalStackLayout>
                </Grid>

                <!-- Tap to show/hide controls -->
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnPlayerTapped" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Drag Handle Bar -->
            <Grid Grid.Row="1"
                  x:Name="dragHandle"
                  BackgroundColor="#1E1E1E"
                  Padding="8,4">
                <Grid.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnDragHandlePan" />
                </Grid.GestureRecognizers>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       x:Name="pipChannelLabel"
                       Text="Channel Name"
                       TextColor="White"
                       FontSize="12"
                       VerticalOptions="Center"
                       LineBreakMode="TailTruncation" />

                <HorizontalStackLayout Grid.Column="1" Spacing="4">
                    <Label Text="â‹®â‹®"
                           TextColor="White"
                           FontSize="12"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Grid>
        </Grid>
    </Border>
</ContentPage>
